<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1, width=device-width" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <title>Hate Groups</title>
</head>
<body>
<div class="container">
    <div class="jumbotron">
        <h1 align="center">Hate Group Data</h1>
    </div>
    <div class="row">
        <ul class="nav nav-tabs">
            <li><a data-toggle="tab" href="#nationwidepane">Nationwide</a></li>
            <li><a data-toggle="tab" href="#statebystatepane">State by State</a></li>
        </ul>
    </div>
    <div class="tab-content">
        <div class="tab-pane" id="nationwidepane">
            <h3>nationwide</h3>
            <table class="table">
                <tr>
                    <td>Population: </td>
                    <td><div id="nw_population"></div></td>
                </tr>
                <tr>
                    <td>Square miles: </td>
                    <td><div id="nw_square_miles"></div></td>
                </tr>
                <tr>
                    <td>Number of Hate Groups: </td>
                    <td><div id="nw_num_groups"></div></td>
                </tr>
                <tr>
                    <td>Most Common Hate Group</td>
                    <td><div id="nw_most_common_group"></div></td>
                </tr>
                <tr>
                    <td>Hate Groups Per Square Mile: </td>
                    <td><div id="nw_groups_square_mile"></div></td>
                </tr>
                <tr>
                    <td>Hate Groups Per Person: </td>
                    <td><div id="nw_groups_person"></div></td>
                </tr>
            </table>
        </div>
        <div class="tab-pane" id="statebystatepane">
            <h3>state by state</h3>
            <table class="table" id="statebystatetable">
                <tr>
                    <th>State</th>
                    <th>Pop</th>
                    <th>Sq/Mi</th>
                    <th># hate groups</th>
                    <th>Most Common Type</th>
                    <th>Hate/Sq Mi</th>
                    <th>Hate/Person</th>
                    <!-- generated html for each state goes here. -->
                    <div id="statebystatedata">
                    </div>
                </tr>
            </table>
        </div>
    </div>
</div>
<script>

$(function(w){

    var success = function(statesHash){

        // state by state data display
        var stateByStateTable = $("#statebystatetable");

        var state;
        var rowObject;
        for(state in statesHash){
            var squareMiles = statesHash[state].square_miles;
            var hateCount = statesHash[state].hate_count;
            var mostCommon = statesHash[state].most_common;
            var population = statesHash[state]["pop"];
            var hateSquareMile = hateCount / squareMiles;
            var hatePerson = hateCount / population;

            var popCell = $("<td>").text(population);
            var stateCell = $("<td>").text(state);
            var squareMilesCell = $("<td>").text(squareMiles);
            var hateCountCell = $("<td>").text(hateCount);
            var mostCommonCell = $("<td>").text(mostCommon);
            var hateSquareMileCell = $("<td>").text(hateSquareMile);
            var hatePersonCell = $("<td>").text(hatePerson);


            var newRow = $("<tr>");
            stateCell.appendTo(newRow);
            popCell.appendTo(newRow);
            squareMilesCell.appendTo(newRow);
            hateCountCell.appendTo(newRow);
            mostCommonCell.appendTo(newRow);
            hateSquareMileCell.appendTo(newRow);
            hatePersonCell.appendTo(newRow);

            newRow.appendTo(stateByStateTable);
        }

        // nationwide data display
        var totalMiles = 0;
        var totalHateCount = 0;
        var totalPopulation = 0;
        for(state in statesHash){
            var squareMiles = statesHash[state].square_miles;
            var hateCount = statesHash[state].hate_count;
            var mostCommon = statesHash[state].most_common;
            var population = statesHash[state]["pop"];

            totalMiles = totalMiles + squareMiles;
            totalHateCount = totalHateCount + hateCount;
            totalPopulation = totalPopulation + Number(population);

        }

        $("#nw_population").text(totalPopulation);
        $("#nw_square_miles").text(totalMiles);
        $("#nw_num_groups").text(totalHateCount);

        var hatePerSquareMile = totalHateCount / totalMiles;
        var hatePerPerson = totalHateCount / totalPopulation;
        $("#nw_groups_square_mile").text(hatePerSquareMile);
        $("#nw_groups_person").text(hatePerPerson);

    };

    var error = function(e){
        console.log("error in ajax request...");
        console.log(e);
    };

    var url = "/hatedata";
    var promise = $.ajax(url);
    promise.then(success, error);

    var promise = $.ajax("/mostcommonhatenationwide");
    promise.then(function(res){
        $("#nw_most_common_group").text(res);
    });

}(window));

</script>
</body>
</html>